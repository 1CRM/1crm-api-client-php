<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>API Client: Authentication</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">API Client
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_authentication.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Authentication </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>1CRM API calls must include authentication information. The API supports two authentication methods: Basic and OAuth 2.0.</p>
<p><a class="el" href="_authentication.html#auth-basic">Basic authentication</a></p>
<p><a class="el" href="_authentication.html#auth-oauth">OAuth 2.0 authentication</a></p>
<ul>
<li><a class="el" href="_authentication.html#auth-oauth-owners">Resource owners</a></li>
<li><a class="el" href="_authentication.html#auth-oauth-scopes">Scopes</a></li>
<li><a class="el" href="_authentication.html#auth-oauth-token">Obtaining access token</a></li>
</ul>
<h1><a class="anchor" id="auth-basic"></a>
Basic authentication</h1>
<p>HTTP Basic authentication is the simplest form of authentication supported by 1CRM API. It uses 1CRM user name and password, and transmits them in HTTP request headers. This simplicity is the only advantage of this authentication method. Username and password are sent in cleartext with each request. Whenever possible, you should prefer OAuth 2.0.</p>
<p>To use basic authentication, you first create an instance of <a class="el" href="class_one_c_r_m_1_1_a_p_i_client_1_1_authentication_1_1_basic.html">OneCRM\APIClient\Authentication\Basic</a>, passing user name and password to constructor. Then create an API client using this authentication object:</p>
<div class="fragment"><div class="line">use <a class="code" href="interface_one_c_r_m_1_1_a_p_i_client_1_1_authentication.html">OneCRM\APIClient\Authentication</a>;</div>
<div class="line">use OneCRM\APIClient;</div>
<div class="line"></div>
<div class="line">$auth = <span class="keyword">new</span> Authentication\Basic(<span class="stringliteral">&#39;admin&#39;</span>, <span class="stringliteral">&#39;admin&#39;</span>);</div>
<div class="line">$client = <span class="keyword">new</span> APIClient\Client(<span class="stringliteral">&#39;https://demo.1crmcloud.com/api.php&#39;</span>, $auth);</div>
<div class="line"><span class="comment">// now $client is ready to make API requests</span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Basic authentication for API is disabled by default. If you want to use it, you have to enable it first, using 1CRM administration interface.</dd></dl>
<h1><a class="anchor" id="auth-oauth"></a>
OAuth 2.0 authentication</h1>
<p>This authentication method uses access tokens. Before making requests, you need to obtain an access toke from the API.</p>
<p>In order to make calls to the 1CRM API using OAuth 2.0, you need to register an application, or API client. Registered clients are assigned a unique Client ID (client_id) and a unique Client Secret (client_secret). Make sure to store the Client Secret securely.</p>
<p>1CRM supports 2 types of API clients: public and private.</p>
<p>Private API clients can be registered by 1CRM administrator, and are intended for use by your organization only. Public API clients are managed by 1CRM Corp., and represent 3rd party applications. If you are developing an application that can be potentially useful for all 1CRM customers, you should apply for a public API client.</p>
<p>Client ID and Client Secret for private clients are available from 1CRM admin interface. For public clients, 1CRM will provide Client ID and Client Secret after creating your API CLient.</p>
<h2><a class="anchor" id="auth-oauth-owners"></a>
Resource owners</h2>
<p>One of roles defined by OAuth 2.0 Authorization Framework is Resource Owner:</p>
<blockquote class="doxtable">
<p>An entity capable of granting access to a protected resource. When the resource owner is a person, it is referred to as an end-user.</p>
<p></p>
</blockquote>
<p>Naturally, in 1CRM, its users are resource owners. API client can be granted access on behalf of a 1CRM user. But there are many cases, when it is also desirable to allow Contacts to authenticate themselves: using 1CRM as single sign-on server, customer portals, etc.</p>
<p>1CRM defines two types of Resource Owners: User and Contact. Depending on type of resource owner you want to authenticate, you use different endpoints. Note that Contact access token only provides access to Contact's own information such as name, email address and telephone number.</p>
<h2><a class="anchor" id="auth-oauth-scopes"></a>
Scopes</h2>
<p>When requesting access to protected resources, API client can specify the scope of request. 1CRM supports 3 scopes:</p>
<ul>
<li><code>read</code> client requests access to read information from 1CRM</li>
<li><code>write</code> client requests access to write information to 1CRM</li>
<li><code>profile</code> client requests access to Resource Owner's account information</li>
</ul>
<p>For Resource Owner of Contact type, only <code>profile</code> scope is allowed. <code>read</code> and <code>write</code> scopes are subject to limitations set by 1CRM administrator using 1CRM ACL system.</p>
<p>If you do not specify a scope in authorization request, <code>profile</code> will be used by default.</p>
<h2><a class="anchor" id="auth-oauth-token"></a>
Obtaining access token</h2>
<p>1CRM API Client library provides several authorization flows</p>
<ul>
<li>Authorization Code Grant - use this flow if you want to authorize a web application.</li>
<li>Resource Owner Password Credentials Grant - use this flow if you want to authenticate directly via 1CRM API using resource ownerâ€™s password credentials.</li>
<li>Client Credentials Grant - use this flow to authorize an application on behalf of predefined 1CRM user. The actual user that gains access in this flow is decided by 1CRM administrator.</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Before using an authorization flow, make sure it is enabled in 1CRM admin interface for the Client ID you are using.</dd></dl>
<h4>Authorization flow parameters</h4>
<p>When starting an authorization flow, you first have to prepare an associative array with following options:</p>
<ul>
<li><code>client_id</code>: API client ID. Required. Can be omited if <code>ONECRM_CLIENT_ID</code> environment variable is set.</li>
<li><code>client_secret</code>: API client secret. Required. Can be omited if <code>ONECRM_CLIENT_SECRET</code> environment variable is set.</li>
<li><code>redirect_uri</code>: Redirect URI. Required for Authorization Code flow. Can be omited if <code>ONECRM_REDIRECT_URI</code> environment variable is set. Must match exactly the Redirect URI set by 1CRM administrator for this specific API client ID.</li>
<li><code>username</code>: 1CRM user name. Required for Resource Owner Password Credentials flow. Can be omited if <code>ONECRM_USERNAME</code> environment variable is set.</li>
<li><code>password</code>: 1CRM user password. Required for Resource Owner Password Credentials flow. Can be omited if <code>ONECRM_PASSWORD</code> environment variable is set.</li>
<li><code>scope</code>: Authorization request scopes, space separated. Optional, defaults to <code>profile</code></li>
<li><code>owner_type</code>: <code>user</code> or <code>contact</code>. Default value is <code>user</code></li>
<li><code>state</code>: CSRF token. Optional</li>
</ul>
<h4>Authorization Code grant</h4>
<p>This flow is a two-step process. First, you make the user visit a special URI where the user logs into 1CRM and grants access to your application. After access is granted, the user is redirected to <b>redirect URI</b> that you specify, and authorization code is passed in URI query parameter. Script at that redirect URI now can obtain an access token.</p>
<div class="fragment"><div class="line">use OneCRM\APIClient;</div>
<div class="line"></div>
<div class="line">$options = [</div>
<div class="line">    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;123456789-xxx-whatever&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;top secret&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;redirect_uri&#39;</span> =&gt; <span class="stringliteral">&#39;https://mydomain.com/redirect.php&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;scope&#39;</span> =&gt; <span class="stringliteral">&#39;read write profile&#39;</span>,</div>
<div class="line">];</div>
<div class="line"></div>
<div class="line">$flow = <span class="keyword">new</span> APIClient\AuthorizationFlow(<span class="stringliteral">&#39;https://demo.1crmcloud.com/api.php&#39;</span>, $options);</div>
<div class="line"></div>
<div class="line">$url = $flow-&gt;init(<span class="stringliteral">&#39;authorization_code&#39;</span>);</div>
<div class="line">header(<span class="stringliteral">&#39;Location: &#39;</span> . $url);</div>
<div class="line"></div>
<div class="line"><span class="comment">// or you can make the library to do the redirect for you by passing true</span></div>
<div class="line"><span class="comment">// as second argument to AuthorizationFlow::init()</span></div>
<div class="line"></div>
<div class="line">$flow-&gt;init(<span class="stringliteral">&#39;authorization_code&#39;</span>, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p>After the user returns to redirect URI, you can obtain an access token from the API:</p>
<div class="fragment"><div class="line">use OneCRM\APIClient;</div>
<div class="line">use <a class="code" href="interface_one_c_r_m_1_1_a_p_i_client_1_1_authentication.html">OneCRM\APIClient\Authentication</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// should be same options as used when calling AuthorizationFlow::init()</span></div>
<div class="line">$options = [</div>
<div class="line">    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;123456789-xxx-whatever&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;top secret&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;redirect_uri&#39;</span> =&gt; <span class="stringliteral">&#39;https://mydomain.com/redirect.php&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;scope&#39;</span> =&gt; <span class="stringliteral">&#39;read write profile&#39;</span>,</div>
<div class="line">];</div>
<div class="line"></div>
<div class="line">$flow = <span class="keyword">new</span> APIClient\AuthorizationFlow(<span class="stringliteral">&#39;https://demo.1crmcloud.com/api.php&#39;</span>, $options);</div>
<div class="line"></div>
<div class="line">$access_token = $flow-&gt;finalize();</div>
<div class="line"></div>
<div class="line">$auth = <span class="keyword">new</span> Authentication\OAuth($access_token);</div>
<div class="line">$client = <span class="keyword">new</span> APIClient\Client(<span class="stringliteral">&#39;https://demo.1crmcloud.com/api.php&#39;</span>, $auth);</div>
<div class="line"><span class="comment">// now $client is ready to make API requests</span></div>
</div><!-- fragment --><h4>Resource Owner Password Credentials Grant</h4>
<p>This grant provides great user experience for web applications and native mobile applications, because it does not require the user to be redirected to 1CRM for password entry. This grant is only available for private API clients.</p>
<div class="fragment"><div class="line">use OneCRM\APIClient;</div>
<div class="line">use <a class="code" href="interface_one_c_r_m_1_1_a_p_i_client_1_1_authentication.html">OneCRM\APIClient\Authentication</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// should be same options as used when calling AuthorizationFlow::init()</span></div>
<div class="line">$options = [</div>
<div class="line">    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;123456789-xxx-whatever&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;top secret&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;scope&#39;</span> =&gt; <span class="stringliteral">&#39;read write profile&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;username&#39;</span> =&gt; <span class="stringliteral">&#39;admin&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;password&#39;</span> =&gt; <span class="stringliteral">&#39;admin&#39;</span>,</div>
<div class="line">];</div>
<div class="line"></div>
<div class="line">$flow = <span class="keyword">new</span> APIClient\AuthorizationFlow(<span class="stringliteral">&#39;https://demo.1crmcloud.com/api.php&#39;</span>, $options);</div>
<div class="line"></div>
<div class="line">$access_token = $flow-&gt;init(<span class="stringliteral">&#39;password&#39;</span>);</div>
<div class="line"></div>
<div class="line">$auth = <span class="keyword">new</span> Authentication\OAuth($access_token);</div>
<div class="line">$client = <span class="keyword">new</span> APIClient\Client(<span class="stringliteral">&#39;https://demo.1crmcloud.com/api.php&#39;</span>, $auth);</div>
<div class="line"><span class="comment">// now $client is ready to make API requests</span></div>
</div><!-- fragment --><h4>Client Credentials Grant</h4>
<p>To enable this grant, 1CRM administrator assigns a user to API client using 1CRM admin interface. After obtaining access token, API client can make requests to the API on behalf of that user. This grant is only available for Resource Owner of User type.</p>
<div class="fragment"><div class="line">use OneCRM\APIClient;</div>
<div class="line">use <a class="code" href="interface_one_c_r_m_1_1_a_p_i_client_1_1_authentication.html">OneCRM\APIClient\Authentication</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// should be same options as used when calling AuthorizationFlow::init()</span></div>
<div class="line">$options = [</div>
<div class="line">    <span class="stringliteral">&#39;client_id&#39;</span> =&gt; <span class="stringliteral">&#39;123456789-xxx-whatever&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;client_secret&#39;</span> =&gt; <span class="stringliteral">&#39;top secret&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;scope&#39;</span> =&gt; <span class="stringliteral">&#39;read write profile&#39;</span>,</div>
<div class="line">];</div>
<div class="line"></div>
<div class="line">$flow = <span class="keyword">new</span> APIClient\AuthorizationFlow(<span class="stringliteral">&#39;https://demo.1crmcloud.com/api.php&#39;</span>, $options);</div>
<div class="line"></div>
<div class="line">$access_token = $flow-&gt;init(<span class="stringliteral">&#39;client_credentials&#39;</span>);</div>
<div class="line"></div>
<div class="line">$auth = <span class="keyword">new</span> Authentication\OAuth($access_token);</div>
<div class="line">$client = <span class="keyword">new</span> APIClient\Client(<span class="stringliteral">&#39;https://demo.1crmcloud.com/api.php&#39;</span>, $auth);</div>
<div class="line"><span class="comment">// now $client is ready to make API requests</span></div>
</div><!-- fragment --><h3>Resfreshing access tokens</h3>
<p>kjkjj </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
