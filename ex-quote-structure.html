<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>API Client: Reconstructing Quote structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">API Client
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="examples.html">Examples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Reconstructing Quote structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>1CRM provides a number of modules representing what we call <b>Tally objects</b>. This includes Quotes, Invoices, Bills, Sales Orders, Purchase Orders, Credit Notes, Shipping and Receiving. They all have a common property: they contain a number of line groups, and each group consists of a number of lines. Each line represents a product, a service, an expense or a comment. Also, a group can contain a number of <em>adjustments</em> such as taxes, discounts etc. Each adjustment can apply to individual line item or to whole group.</p>
<p>We at 1CRM are working to add special methods to the REST API to make using the API with Tally objects easier, but currently you have to use general API requests to access information about Quotes, Invoices etc.</p>
<p>The structure of Tally object may be a bit complicated and you need some time and effort to understand it. Data is scattered across several database tables - in fact, there are 5 tables for each kind of Tally object: the tally record itself, line groups, line items, comments and adjustments. Groups, lines, comments and adjustments have a "position" field that allows to place them in correct order when reconstructing quote structure.</p>
<p>First, you get list of groups:</p>
<div class="fragment"><div class="line">$model = $client-&gt;model(<span class="stringliteral">&#39;Quote&#39;</span>);</div>
<div class="line">$quote_id = <span class="stringliteral">&#39;6b39fc26-3330-fd5b-a592-5aa798039309&#39;</span>;</div>
<div class="line">$result = $model-&gt;getRelated($quote_id, <span class="stringliteral">&#39;line_groups_link&#39;</span>);</div>
<div class="line">echo json_encode($result-&gt;getRecords(), JSON_PRETTY_PRINT), <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><div class="fragment"><div class="line">[</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;Group 1&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;6b6b0438-cd4a-0990-423b-5aa7988d4d4a&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: <span class="stringliteral">&quot;Group 1&quot;</span></div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;Group 2&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;67dedd63-344a-4582-af46-5aab714aa5d6&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: <span class="stringliteral">&quot;Group 2&quot;</span></div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><p>Then, obtain lines:</p>
<div class="fragment"><div class="line">$model = $client-&gt;model(<span class="stringliteral">&#39;Quote&#39;</span>);</div>
<div class="line">$line_fields = [<span class="stringliteral">&#39;position&#39;</span>, <span class="stringliteral">&#39;line_group_id&#39;</span>];</div>
<div class="line">$quote_id = <span class="stringliteral">&#39;6b39fc26-3330-fd5b-a592-5aa798039309&#39;</span>;</div>
<div class="line">$result = $model-&gt;getRelated($quote_id, <span class="stringliteral">&#39;lines_link&#39;</span>, [<span class="stringliteral">&#39;fields&#39;</span> =&gt; $line_fields]);</div>
<div class="line">echo json_encode($result-&gt;getRecords(), JSON_PRETTY_PRINT), <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><div class="fragment"><div class="line">[</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;9&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;67dedd63-344a-4582-af46-5aab714aa5d6&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;67e184ad-0f64-74c4-a160-5aab7191a45c&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;HP LaserJet Pro M476DW MFP &quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: <span class="stringliteral">&quot;HP LaserJet Pro M476DW MFP &quot;</span></div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;4&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;6b6b0438-cd4a-0990-423b-5aa7988d4d4a&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;6b6e15d9-9954-8fa1-c076-5aa79845ea9c&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;Retina MacBook 12\&quot; 512GB&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: <span class="stringliteral">&quot;Retina MacBook 12\&quot; 512GB&quot;</span></div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;14&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;6b6b0438-cd4a-0990-423b-5aa7988d4d4a&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;6b6d0e2e-d182-b6bd-3fde-5aa798c62cd2&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;iPad Air 2 \/ 64 GB \/ Gold&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: <span class="stringliteral">&quot;iPad Air 2 \/ 64 GB \/ Gold&quot;</span></div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><p>and comments:</p>
<div class="fragment"><div class="line">$model = $client-&gt;model(<span class="stringliteral">&#39;Quote&#39;</span>);</div>
<div class="line">$comment_fields = [<span class="stringliteral">&#39;position&#39;</span>, <span class="stringliteral">&#39;line_group_id&#39;</span>, <span class="stringliteral">&#39;body&#39;</span>];</div>
<div class="line">$quote_id = <span class="stringliteral">&#39;6b39fc26-3330-fd5b-a592-5aa798039309&#39;</span>;</div>
<div class="line">$result = $model-&gt;getRelated($quote_id, <span class="stringliteral">&#39;comments_link&#39;</span>, [<span class="stringliteral">&#39;fields&#39;</span> =&gt; $comment_fields]);</div>
<div class="line">echo json_encode($result-&gt;getRecords(), JSON_PRETTY_PRINT), <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><div class="fragment"><div class="line">[</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;4&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;67dedd63-344a-4582-af46-5aab714aa5d6&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;body&quot;</span>: <span class="stringliteral">&quot;This is another comment&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;67e2de92-b449-c9b5-49dc-5aab71d5e786&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: null</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;9&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;6b6b0438-cd4a-0990-423b-5aa7988d4d4a&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;body&quot;</span>: <span class="stringliteral">&quot;This is a comment&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;e7905680-bfc7-6151-2a31-5aab70fce466&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: null</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><p>After these requests, we can see that the quote contains 2 groups. In 1st group, we have <b>Retina macbook</b>, <b>This is a comment</b>, and <b>iPad Air</b>, and the second group contains <b>This is another comment</b> and <b>HP LaserJet</b>, exactly in that order if you sort by <code>position</code> field.</p>
<p>And now come the adjustments</p>
<div class="fragment"><div class="line">$model = $client-&gt;model(<span class="stringliteral">&#39;Quote&#39;</span>);</div>
<div class="line">$adj_fields = [<span class="stringliteral">&#39;position&#39;</span>, <span class="stringliteral">&#39;line_group_id&#39;</span>, <span class="stringliteral">&#39;line_id&#39;</span>, <span class="stringliteral">&#39;related_type&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;related_id&#39;</span>];</div>
<div class="line">$quote_id = <span class="stringliteral">&#39;6b39fc26-3330-fd5b-a592-5aa798039309&#39;</span>;</div>
<div class="line">$result = $model-&gt;getRelated($quote_id, <span class="stringliteral">&#39;adjustments_link&#39;</span>, [<span class="stringliteral">&#39;fields&#39;</span> =&gt; $adj_fields]);</div>
<div class="line">echo json_encode($result-&gt;getRecords(), JSON_PRETTY_PRINT), <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><div class="fragment"><div class="line">[</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;0&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;67dedd63-344a-4582-af46-5aab714aa5d6&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_id&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;related_type&quot;</span>: <span class="stringliteral">&quot;ShippingProviders&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;UntaxedShipping&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;related_id&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;67e59e5c-400e-5148-7296-5aab71217ffe&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: null</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;0&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;6b6b0438-cd4a-0990-423b-5aa7988d4d4a&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_id&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;related_type&quot;</span>: <span class="stringliteral">&quot;Discounts&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;StandardDiscount&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;related_id&quot;</span>: <span class="stringliteral">&quot;b6cbc17e-8d2a-5d06-a0d9-5aa798d23108&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;6b6f1541-5ddf-d55f-ada8-5aa798d86f27&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;Preferred Customer&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: <span class="stringliteral">&quot;Preferred Customer&quot;</span></div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;6b6b0438-cd4a-0990-423b-5aa7988d4d4a&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_id&quot;</span>: <span class="stringliteral">&quot;6b6e15d9-9954-8fa1-c076-5aa79845ea9c&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;related_type&quot;</span>: <span class="stringliteral">&quot;Discounts&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;StdPercentDiscount&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;related_id&quot;</span>: <span class="stringliteral">&quot;af2aa23a-17b7-4ed8-4bcb-5aa7984efed5&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;8e2f1ca0-a5ee-b6c0-583e-5aab78a14bbd&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: null</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;6b6b0438-cd4a-0990-423b-5aa7988d4d4a&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_id&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;related_type&quot;</span>: <span class="stringliteral">&quot;TaxRates&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;StandardTax&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;related_id&quot;</span>: <span class="stringliteral">&quot;84e86b71-ba97-6845-b8f9-5aa79860d367&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;8e3146d5-d59f-a3d6-2656-5aab788f2b81&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;HST&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: <span class="stringliteral">&quot;HST&quot;</span></div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;position&quot;</span>: <span class="stringliteral">&quot;3&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_group_id&quot;</span>: <span class="stringliteral">&quot;6b6b0438-cd4a-0990-423b-5aa7988d4d4a&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;line_id&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;related_type&quot;</span>: <span class="stringliteral">&quot;ShippingProviders&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;UntaxedShipping&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;related_id&quot;</span>: <span class="stringliteral">&quot;d2dcb774-af3d-9702-d2c7-5aa7988181ed&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;6b6fe0fa-718b-e46e-ae9c-5aa798393ba2&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: null,</div>
<div class="line">        <span class="stringliteral">&quot;_display&quot;</span>: null</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><p>What can we learn from this information? Both groups have shipping specified. First group has Preferred customer discount and HST tax applied. Also, Retina Macbook has a Discount.</p>
<p>Depending on what you want to achieve, you may need to fetch more fields - only most common fields are shown here, for brevity.</p>
<p>The best way to understand how all parts fit together is to make changes to a quote using 1CRM UI, and see how the cahnges affect the API output. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
